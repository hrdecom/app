<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>HRD MAGIC</title>
  <link rel="stylesheet" href="app.css"/>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
</head>
<body>

<div id="app">
  <header class="header">
    <div class="brand"><div class="logo">‚úß</div><h1>HRD MAGIC</h1></div>
    <button id="settingsBtn" class="icon-btn">‚öôÔ∏è Param√®tres</button>
  </header>

  <div id="settingsModal" class="modal hidden">
    <div class="modal-content">
      <div class="modal-header"><h2>Configuration</h2><button id="closeSettings" class="close-btn">√ó</button></div>
      <div class="tabs">
        <button class="tab-link active" data-tab="tab-prompts">Prompts IA</button>
        <button class="tab-link" data-tab="tab-headlines-config">Headlines</button>
        <button class="tab-link" data-tab="tab-ads-config">Ad Copys</button>
        <button class="tab-link" data-tab="tab-img-styles">Studio Images</button>
        <button class="tab-link" data-tab="tab-translate-config">Traduction</button>
        <button class="tab-link" data-tab="tab-blacklist">Blacklist</button>
      </div>

      <div class="tab-container-scroll">
          <div id="tab-prompts" class="tab-content">
            <div class="prompt-segment"><label>1. R√¥le Syst√®me</label><textarea id="promptSystem" rows="4"></textarea></div>
            <div class="prompt-segment"><label>2. R√®gles pour les Titres</label><textarea id="promptTitles" rows="4"></textarea></div>
            <div class="prompt-segment"><label>3. R√®gles pour les Descriptions</label><textarea id="promptDesc" rows="4"></textarea></div>
          </div>

          <div id="tab-headlines-config" class="tab-content hidden">
            <label>Prompt Principal Headlines</label><textarea id="promptHeadlines" rows="6"></textarea>
            <label>Boutons de Styles</label><div id="styleButtonsEditor"></div><button id="addStyleBtn" class="secondary-btn">+ Ajouter style</button>
          </div>

          <div id="tab-ads-config" class="tab-content hidden">
            <label>Prompt Principal Ad Copys</label><textarea id="promptAdCopys" rows="6"></textarea>
            <label>Boutons de Styles Ads</label><div id="adStyleButtonsEditor"></div><button id="addAdStyleBtn" class="secondary-btn">+ Ajouter style</button>
          </div>

          <div id="tab-img-styles" class="tab-content hidden" style="padding:0; background:#F2F2F7;">
             <div class="tree-toolbar">
                <input type="text" id="newCatName" placeholder="Nom nouvelle Cat√©gorie..." style="flex:1;">
                <button id="addCategoryBtn" class="primary-btn small-btn">+ Ajouter</button>
             </div>
             <div class="tree-editor-wrapper">
                <div class="tree-editor-container" id="treeEditor">
                    <div style="padding:40px; text-align:center; color:#999; font-weight:500;">Chargement...</div>
                </div>
             </div>

             <div id="nodeEditorOverlay" class="hidden" style="position:absolute; inset:0; background:rgba(255,255,255,0.6); backdrop-filter:blur(20px); z-index:10; display:flex; align-items: center; justify-content: center; padding:20px;">
                <div style="background:#fff; width: 100%; max-width: 450px; border-radius:18px; box-shadow:0 10px 40px rgba(0,0,0,0.15); border:1px solid #e5e5e5; overflow: hidden; display:flex; flex-direction:column;">
                    <div style="padding: 15px 20px; border-bottom: 1px solid #eee; display:flex; justify-content:space-between; align-items:center; background: #fbfbfd;">
                         <h3 id="nodeEditorTitle" style="margin:0; font-size: 16px;">√âditer</h3>
                         <button id="cancelNodeBtn" style="background:none; border:none; color:#007AFF; font-weight:600; cursor:pointer;">Annuler</button>
                    </div>

                    <div style="padding:20px; display:flex; flex-direction:column; gap: 15px;">
                        <input type="hidden" id="editNodeId">
                        <input type="hidden" id="editNodeType">
                        
                        <div>
                            <label style="display:block; font-size:11px; font-weight:600; color:#888; margin-bottom:5px; text-transform:uppercase;">Nom</label>
                            <input type="text" id="editNodeName" class="ios-input" placeholder="Nom...">
                        </div>
                        
                        <div id="editPromptContainer" class="hidden">
                            <label style="display:block; font-size:11px; font-weight:600; color:#888; margin-bottom:5px; text-transform:uppercase;">Prompt IA</label>
                            <textarea id="editNodePrompt" rows="3" class="ios-input" placeholder="Prompt..."></textarea>
                            
                            <div style="margin-top:15px;">
                                <label style="display:block; font-size:11px; font-weight:600; color:#888; margin-bottom:5px; text-transform:uppercase;">Image (Optionnel)</label>
                                <div style="display:flex; gap:10px; align-items:center;">
                                    <div id="editNodeImgPreview" style="width:40px; height:40px; background:#f0f0f0; border-radius:8px; overflow:hidden; border:1px solid #ddd; flex-shrink:0;"></div>
                                    <input type="file" id="editNodeFile" accept="image/*" style="font-size:12px;">
                                </div>
                            </div>
                            
                            <div style="margin-top:15px;">
                                <label style="display:block; font-size:11px; font-weight:600; color:#888; margin-bottom:5px; text-transform:uppercase;">Mode</label>
                                <select id="editNodeMode" class="ios-input">
                                    <option value="auto">‚ö° Auto (Envoi direct)</option>
                                    <option value="manual">üìù Manuel (Ajout texte)</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div style="padding: 15px 20px; background: #fbfbfd; border-top: 1px solid #eee; display:flex; justify-content:space-between;">
                         <button id="deleteNodeBtn" style="color:#FF3B30; background:none; border:none; font-weight:600; cursor:pointer;">Supprimer</button>
                         <button id="saveNodeBtn" class="primary-btn" style="padding: 6px 20px; border-radius: 20px;">Enregistrer</button>
                    </div>
                </div>
             </div>
          </div>

          <div id="tab-translate-config" class="tab-content hidden">
            <label>Prompt Principal Traduction</label><textarea id="promptTranslate" rows="12"></textarea>
          </div>
          <div id="tab-blacklist" class="tab-content hidden"><textarea id="configBlacklist" rows="12"></textarea></div>
      </div>

      <div class="modal-footer"><button id="saveConfig" class="primary-btn">Enregistrer tout</button></div>
    </div>
  </div>

  <div id="headlinesModal" class="modal hidden">
    <div class="modal-content">
      <div class="modal-header">
          <h2>Headlines Vid√©os</h2>
          <div class="dropdown">
              <button id="translateHlMenuBtn" class="secondary-btn">üåç Traduire...</button>
              <div id="hlLangList" class="dropdown-content"></div>
          </div>
          <button id="closeHeadlines" class="close-btn">√ó</button>
      </div>
      <div class="tabs" id="headlinesTabs">
        <button class="tab-link active" data-tab="tab-gen-headlines">G√©n√©rer</button>
        <button class="tab-link" data-tab="tab-saved-headlines">Enregistr√©es</button>
      </div>
      <div id="headlinesTabContainer" class="tab-container-scroll">
          <div id="tab-gen-headlines" class="tab-content">
            <div class="style-selector" id="styleSelectorContainer"></div>
            <div id="headlinesResults" class="headlines-results"></div>
            <div class="headlines-actions-wrapper">
                <div class="headlines-actions hidden" id="similarActions">
                    <button id="genSimilarBtn" class="secondary-btn" style="width:100%; color: var(--apple-blue);">‚ú® G√©n√©rer versions similaires</button>
                </div>
                <div id="headlinesLocalPagination" class="pagination"></div>
            </div>
          </div>
          <div id="tab-saved-headlines" class="tab-content hidden">
            <div id="headlinesSavedList" class="headlines-results"></div>
          </div>
      </div>
      <div class="chat-container"><div class="chat-bar"><input type="text" id="headlineStyleInput" placeholder="Style..."/><button id="sendHeadlineChat">‚Üë</button></div></div>
      <div class="modal-footer"><button id="saveHeadlinesBtn" class="primary-btn">Enregistrer s√©lections</button></div>
    </div>
  </div>

  <div id="adsModal" class="modal hidden">
    <div class="modal-content">
      <div class="modal-header">
          <h2>Ad Copys</h2>
          <div class="dropdown">
              <button id="translateAdMenuBtn" class="secondary-btn">üåç Traduire...</button>
              <div id="adLangList" class="dropdown-content"></div>
          </div>
          <button id="closeAds" class="close-btn">√ó</button>
      </div>
      <div class="tabs" id="adsTabs">
        <button class="tab-link active" data-tab="tab-gen-ads">G√©n√©rer</button>
        <button class="tab-link" data-tab="tab-saved-ads">Enregistr√©s</button>
      </div>
      <div id="adsTabContainer" class="tab-container-scroll">
          <div id="tab-gen-ads" class="tab-content">
            <div class="style-selector" id="adStyleSelectorContainer"></div>
            <div id="adsResults" class="headlines-results"></div>
            <div class="headlines-actions-wrapper">
                <div class="headlines-actions hidden" id="similarAdsActions">
                    <button id="genSimilarAdsBtn" class="secondary-btn" style="width:100%; color: var(--apple-blue);">‚ú® G√©n√©rer versions similaires</button>
                </div>
                <div id="adsLocalPagination" class="pagination"></div>
            </div>
          </div>
          <div id="tab-saved-ads" class="tab-content hidden">
            <div id="adsSavedList" class="headlines-results"></div>
            <div id="adsDefaultInfoBlock" class="ads-info-block"></div>
          </div>
      </div>
      <div class="chat-container"><div class="chat-bar"><input type="text" id="adStyleInput" placeholder="Style..."/><button id="sendAdChat">‚Üë</button></div></div>
      <div class="modal-footer"><button id="saveAdsBtn" class="primary-btn">Enregistrer s√©lections</button></div>
    </div>
  </div>

  <div id="imgGenModal" class="modal hidden">
    <div class="modal-content" style="max-width: 1000px; flex-direction: row;">
      
      <div style="flex: 3; display: flex; flex-direction: column; border-right: 1px solid var(--border);">
        <div class="modal-header">
          <h2>Studio Gemini</h2>
        </div>
        
        <div class="tabs">
          <button class="tab-link active" data-tab="tab-img-chat">G√©n√©ration</button>
          <button class="tab-link" data-tab="tab-img-saved">Enregistr√©es</button>
        </div>

        <div class="tab-container-scroll" style="background: #fbfbfd;">
           <div id="tab-img-chat" class="tab-content" style="padding: 20px;">
              <div id="imgGenSessionResults" class="image-grid"></div>
           </div>

           <div id="tab-img-saved" class="tab-content hidden" style="padding: 20px;">
              <div id="imgGenSavedResults" class="image-grid"></div>
           </div>
        </div>

        <div class="chat-container">
           <div id="imgGenCategoriesBar" style="display:flex; gap:8px; overflow-x:auto; padding-bottom:10px; margin-bottom:10px; border-bottom:1px solid #f0f0f0;"></div>
           
           <div id="imgGenStylesContainer" style="display:flex; flex-direction:column; gap:15px; margin-bottom:10px; border-bottom:1px solid #f0f0f0; min-height: 50px;"></div>

           <div id="inputImagesPreview" class="input-images-bar hidden"></div>
           
           <div class="chat-bar" style="align-items:flex-end;">
             <button id="addInputImgBtn" style="background:none; color:#555; border:1px solid #ddd; margin-right:5px; flex-shrink:0;" title="Ajouter une image r√©f√©rence">+</button>
             <textarea id="imgGenPrompt" placeholder="D√©crivez l'image √† g√©n√©rer..." rows="1" style="resize:none; overflow:hidden; min-height:32px; max-height:150px;"></textarea>
             <button id="sendImgGen" style="flex-shrink:0;">‚ú®</button>
           </div>
           <input type="file" id="extraImgInput" accept="image/*" multiple style="display:none;"/>
        </div>
      </div>

      <div style="flex: 1; display: flex; flex-direction: column; background: #fff;">
         <div class="modal-header" style="justify-content: flex-end;">
            <button id="closeImgGen" class="close-btn">√ó</button>
         </div>
         <div style="padding: 20px; display: flex; flex-direction: column; gap: 20px;">
            
            <div class="setting-group">
               <label style="font-size:11px; font-weight:bold; color:var(--text-muted); text-transform:uppercase;">Nombre d'images</label>
               <select id="imgCount" class="settings-select">
                  <option value="1">1</option>
                  <option value="2" selected>2</option>
                  <option value="3">3</option>
                  <option value="4">4</option>
                  <option value="5">5</option>
               </select>
            </div>

            <div class="setting-group">
               <label style="font-size:11px; font-weight:bold; color:var(--text-muted); text-transform:uppercase;">Aspect Ratio</label>
               <select id="imgAspectRatio" class="settings-select">
                  <option value="1:1">1:1 (Carr√©)</option>
                  <option value="16:9">16:9 (Paysage)</option>
                  <option value="9:16">9:16 (Story)</option>
                  <option value="4:3">4:3</option>
                  <option value="3:4">3:4</option>
               </select>
            </div>
            
            <div class="setting-group">
               <label style="font-size:11px; font-weight:bold; color:var(--text-muted); text-transform:uppercase;">R√©solution / Qualit√©</label>
               <select id="imgResolution" class="settings-select">
                  <option value="1k">1k (Standard)</option>
                  <option value="2k">2k (Haute D√©f.)</option>
                  <option value="4k" selected>4k (Ultra HD)</option>
               </select>
            </div>

            <div style="margin-top:auto;">
               <button id="saveImgSelectionBtn" class="primary-btn" style="width:100%;">Enregistrer S√©lection</button>
            </div>
         </div>
      </div>

    </div>
  </div>

  <div id="loading" class="loading hidden"><div class="spinner"></div><div><strong>Action en cours...</strong><div id="timer">00:00</div></div></div>

  <section class="workspace">
    <div class="left">
        <div id="drop" class="drop">
          <input id="imageInput" type="file" accept="image/*"/>
          <div id="preview" class="preview hidden"><button id="removeImage" class="modern-remove-btn">√ó</button><img id="previewImg"/></div>
          <p id="dropPlaceholder">Cliquez ou d√©posez une image</p>
        </div>
        <div id="savedImagesCarousel" class="saved-carousel hidden"></div>
        <button id="openImgGenBtn" class="secondary-btn" style="width: 100%; margin-top: 15px; display: flex; align-items: center; justify-content: center; gap: 8px;">
           <span>üé®</span> Generate Images
        </button>
        <button id="downloadAllImagesBtn" class="secondary-btn hidden" style="width: 100%; margin-top: 8px; display: flex; align-items: center; justify-content: center; gap: 8px;">
           <span>üì•</span> Download All Images
        </button>
    </div>
    <div class="right">
      <section class="card generation-card">
        <div class="suggestion-row">
          <input type="text" id="suggestionInput" placeholder="Suggestion optionnelle (ex: style vintage, ton luxueux...)" />
        </div>
        <div class="actions">
          <button id="generateBtn" class="primary-btn" disabled>G√©n√©rer Tout</button>
          <button id="regenTitleBtn" class="secondary-btn" disabled>‚Üª Titre</button>
          <button id="regenDescBtn" class="secondary-btn" disabled>‚Üª Description</button>
        </div>
      </section>
      <section class="card">
        <div class="card-head">
          <h3>Titre</h3>
          <div style="display:flex; gap:8px;">
            <button id="editTitle" class="copy-btn">Modifier</button>
            <button id="copyTitle" class="copy-btn">Copier</button>
          </div>
        </div>
        <div id="titleText" class="editable-content" contenteditable="false" data-placeholder="Le titre appara√Ætra ici..."></div>
      </section>
      <section class="card">
        <div class="card-head">
          <h3>Description</h3>
          <div style="display:flex; gap:8px;">
            <button id="editDesc" class="copy-btn">Modifier</button>
            <button id="copyDesc" class="copy-btn">Copier</button>
          </div>
        </div>
        <div id="descText" class="editable-content" contenteditable="false" data-placeholder="La description appara√Ætra ici..."></div>
        <div class="product-url-section">
          <label>Product URL</label>
          <input type="text" id="productUrlInput" placeholder="https://en.riccardiparis.com/..."/>
        </div>
        <div class="action-buttons">
          <button id="openHeadlinesBtn" class="secondary-btn">üé¨ Headlines</button>
          <button id="openAdsBtn" class="secondary-btn">üì¢ Ad Copys</button>
        </div>
      </section>
    </div>
  </section>

  <section class="card history-section">
    <div class="history-header"><h2>Historique</h2><input type="text" id="historySearch" placeholder="Filtrer..."/></div>
    <div id="historyList" class="history-list"></div>
    <div id="pagination" class="pagination"></div>
  </section>
</div>

<script src="app.js"></script>
</body>
</html>
